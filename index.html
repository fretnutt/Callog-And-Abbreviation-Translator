<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Call Logger & Abbreviation Translator</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f4f4f4; color: #333; }
        .container { display: flex; gap: 20px; width: 100%; margin-bottom: 20px; }
        .box { flex: 1; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); }
        textarea { width: 100%; height: 150px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px; resize: vertical; }
        h1, h2 { color: #0056b3; margin-top: 0; }
        #abbreviationsContainer { margin-top: 20px; padding-top: 20px; border-top: 1px solid #ddd; }

        .abbreviations-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        #toggleAllBtn, #copyToScratchpadBtn {
            padding: 8px 12px;
            border: 1px solid #0056b3;
            background-color: #007bff;
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }
        #toggleAllBtn:hover, #copyToScratchpadBtn:hover {
            background-color: #0056b3;
        }
        #copyToScratchpadBtn {
            display: block;
            margin-top: 10px;
        }
        
        .section {
            background-color: #fff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .section-title {
            font-weight: bold;
            color: #0056b3;
            font-size: 1.2em;
            margin: 0;
            cursor: pointer;
            position: relative;
            padding-right: 20px;
        }

        .section-title::after {
            content: 'â–¶';
            position: absolute;
            right: 5px;
            font-size: 0.8em;
            transition: transform 0.2s;
        }

        .section-title.active::after {
            transform: rotate(90deg);
        }
        
        .section-content {
            display: none;
            padding-top: 15px;
        }

        .section-content.active {
            display: block;
        }
        
        .subsection-title {
            font-weight: bold;
            color: #333;
            font-size: 1.1em;
            margin-top: 10px;
            margin-bottom: 5px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        
        .template-title {
             display: inline;
             border-bottom: none;
             margin-right: 10px;
        }

        .term-list {
            list-style-type: none;
            padding-left: 0;
            margin: 10px 0 0 0;
            font-size: 14px;
            column-count: 3;
            column-gap: 20px;
        }
        
        .template-list, .term-list-single-col {
             list-style-type: none;
             padding-left: 0;
             margin: 0;
             column-count: 1;
        }
        
        .template-list li, .term-list-single-col li {
             margin-bottom: 15px;
        }

        .term-list li {
            margin-bottom: 4px;
            -webkit-column-break-inside: avoid;
            page-break-inside: avoid;
            break-inside: avoid;
        }
        
        .toggle-def-btn {
            margin-left: 5px;
            padding: 2px 6px;
            font-size: 12px;
            cursor: pointer;
        }
        .collapsible-def {
            display: none;
            white-space: pre-wrap;
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-left: 3px solid #007bff;
            padding: 10px;
            margin-top: 5px;
            border-radius: 4px;
            font-family: monospace;
        }
        .collapsible-def.visible {
            display: block;
        }

        @media (max-width: 900px) { 
            .container { flex-direction: column; }
            .term-list { column-count: 2; } 
        }
        @media (max-width: 600px) { 
            .term-list { column-count: 1; } 
        }
    </style>
</head>
<body>
    <h1>Call Logger & Abbreviation Translator</h1>
    <div class="container">
        <div class="box">
            <h2>Enter Text Here:</h2>
            <textarea id="inputText" placeholder="Start typing... for example: cs my veh has an iss with the eng"></textarea>
        </div>
        <div class="box">
            <h2>Translated Text:</h2>
            <textarea id="translatedText" readonly></textarea>
            <button id="copyToScratchpadBtn">Copy to Scratch Pad</button>
        </div>
        <div class="box">
            <h2>Scratch Pad</h2>
            <textarea id="scratchPad" placeholder="Your notes here..."></textarea>
        </div>
    </div>
    <div id="abbreviationsContainer">
        <div class="abbreviations-header">
            <h2>Available Abbreviations</h2>
            <button id="toggleAllBtn">Toggle All</button>
        </div>
        <div id="abbreviationsList"></div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const masterList = [
            {
                main_section: "Checklists & Verbiage",
                is_template_section: true,
                templates: [
                    { abbr: "bcl", title: "Buyback Checklist", text: "Mileage: \nCurrent Concerns: \nIs the vehicle currently at a GM dealership? (Yes/No) \nRepair Order Open Date: \nDiagnosis: \nIs the customer in a courtesy/rental vehicle? \nDealership & Customer Feedback: \nImportant vehicle information or feedback from the dealership: \nAssistance & Involvement: \nHas any goodwill or cost assistance been offered? (Yes/No) \nHas TAC been involved? (Yes/No) \nTAC case number and feedback: \nName of CEM at the dealer: \nSelling Information: \nDate vehicle was purchased: \nWas the customer in the military at time of purchase? (Yes/No) \nSelling dealer name and BAC: \nVehicle delivery type: \nWas the vehicle purchased new or used? \nTOTAL days vehicle has been down: \nSummary: \nBrief Repair Summary: \nAny other relevant facts for the business case:" },
                    { abbr: "icl", title: "Initial Customer Intake", text: "VEHICLE:\nVEHICLE SYMPTOMS:\nVIN:\nMILEAGE:\nVEHICLE LOCATION:\nAPPT/REPAIR STATUS:\nDLR/BAC:\nDIAGNOSIS:\nREPAIR ETA:\nPREVIOUS COMPLAINTS:\nBAC PROVIDE COURTESY TRANS?\nVEHICLE PURPOSE: Personal Use\nVEHICLE DELIVERY TYPE: Retail/Individual\nBTTC:\nCUSTOMER PROFILE:\nREGION:" },
                    { abbr: "bbd", title: "Buyback Denial Verbiage", text: "Here is an example of buyback denial verbiage, drawing on the provided sources:\n\"Mr./Ms. [Customer's Last Name], thank you for reaching out to us. I've thoroughly reviewed your situation regarding your [Vehicle Model] and the concerns you've raised, and I want to start by saying I understand your frustration. It's definitely not the experience we want you to have with your GM vehicle.\nAfter a comprehensive review of all the details, including the service history for your vehicle and the terms of the manufacturer's limited warranty, we've determined that we are unable to approve your request for a vehicle buyback or to cover the current repair costs...\"" },
                    { abbr: "pwc", title: "Paint Warranty", text: "Chevrolet's paint warranty covers defects related to materials or workmanship.\nKey Coverage Details:\n- Surface Corrosion: Body sheet metal panels are covered against rust for 3 years or 36,000 miles, whichever comes first...\nWhat is NOT Covered (Paint):\n- Cosmetic/Surface Corrosion...\n- Environmental Damage...\n- After-manufacture Treatments...\n- Improper Cleaning Agents/Methods..." },
                    { abbr: "twc", title: "Tire Warranty", text: "Tires supplied with your Chevrolet vehicle are covered under the Bumper-to-Bumper coverage against defects in material or workmanship...\nKey Coverage Details:\n- Initial Period: ...\n- Prorated Schedule (Tire Cost): ...\nWhat is NOT Covered (Tires):\n- Normal Wear and Wear-out...\n- Road Hazard Damage...\n- Misuse/Improper Operation..." }
                ]
            },
            {
                main_section: "Customer Statements",
                sub_sections: [ { title: "Requests & Desires", terms: { "cbb": "The Customer Requested a Repurchase...", "cec": "The customer is expecting compensation", "crd": "Customer wants to know if we received their sent documentation.", "cmc": "The Customer Expects More Compensation", "cre": "Customer wants to know more about a Recall...", "cri": "Customer called requesting information", "crr": "The Customer Would Like Warranty Rental Reimbursement", "crs": "Customer Called about their repair status.", "csa": "Customer Called About Their Existing Service Request...", "ctw": "The Customer Would LIke Tow Reimbursement", "cwu": "The Customer wants an update on...", "cwr": "The Customer wants a replacement vehicle..." } }, { title: "State & Feelings", terms: { "ccc": "The customer stated they were concerned.", "cex": "The customer expects or is expecting", "cf": "The customer feels.", "cfc": "The customer feels that their issue should be covered", "csd": "Customer upset that their Dealer Is not diagnosing fast enough.", "cup": "Customer is Upset", "coe": "Customer Upset that their Owning Advisor is not meeting...", "cw": "The Customer wants..." } }, { title: "Allegations & Complaints", terms: { "cac": "Accusation/Accuses", "caf": "Customer alleges GM Dealer caused further damages...", "cal": "The customer alleges", "cbe": "The Customer Was Beligerent...", "cdh": "The customer alleges that their GM Dealer are not being forthright about     " } }, { title: "Reports & General", terms: { "cs": "The Customer Stated", "ccb": "The Customer Called Because", "cpt": "Customer states he previously requeststed Manager follow...", "crt": "Customer said Roadside towed to a GM Dealer.", "coa": "The customer advised that his Owning Advisor is not following up...", "cod": "Customer mentioned issues requiring transfer to", "crb": "The Customer States They Were Referred By", "crp": "Repeat Repairs/Multiple Appointments", "dad": "Customer states vehicle is/has been down at GM Dealer for ", "dal": "The customer has a GM Dealer Allegation...", "cis": "The Customer's Issue is", "cju": "The customer attempted to justify...", "cok": "Customer accepted current final resolution/update/offer...", "cdc": "The customer intentionally disconnected our call.", "cnf": "Customer requested nothing further", "crf": "Customer Refused Resolution", "csc": "Customer called about Special Coverage..." } } ]
            },
            {
                main_section: "Agent Statements & Communications",
                sub_sections: [ { title: "Advising", terms: { "iac": "I advised the Customer", "idg": "I advised to Customer that Dealer determines from diagnosis...", "idi": "I advised the customer that since GM Dealer's are independent businesses...", "idh": "I advised the customer I will contact their dealer...", "idb": "I advised to the customer that their repurchase request was carefully reviewed and denied...", "idr": "I advised the customer that when the GM Dealer referred him to Customer Care...", "iib": "I advised the customer that in addition to the standard eligibility criteria...", "icdn": "The Customer Was Advised of Documents Needed...", "ice": "I let the customer know their request is Awaiting executive approval", "idc": "Customer was advised their complaint will be submitted...", "isc": "I advised customer about Special Coverages...", "iwr": "I advised to Customer that the New Vehicle Manufacturer Warranty...", "ica": "I have sent your allegation/s to the General Motors Dealer...", "irr": "Advised customer their request is being reviewed...", "iei": "I educated customer of GM internal, non-customer facing verbiage." } }, { title: "Actions Logged", terms: { "pde": "I confirmed customer request related to a part eligible...", "itr": "I attempted troubleshooting recommendations...", "imc": "I made contact with the customer", "ied": "I educated the customer", "idv": "I left a detailed voicemail...", "ivm": "Left Voicemail", "ipii": "I confirmed the customer Personal Identification Information...", "ipc": "I provided the customer with their case number.", "ion": "I provided the customer with their Owning Advisor's First name only.", "ipd": "I provided the customer with the denial", "ipi": "The Customer Requested Information & I Provided:", "ix": "I referred customer or customer requested being transferred to:", "ixe": "Customer was referred and transferred to EV Conceirge", "ixo": "The customer's advisor was available to transfer...", "ixr": "I offered transfer to Roadside. Customer accepted.", "aot": "The owning advisor was available in OMNI...", "cdo": "Customer was advised to send the appropriate documentation...", "eca": "Customer was educated on GM Cost Assistance policy...", "icr": "Customer was made aware of the recall...", "ide": "I de-escalated the customer who was angry" } } ]
            },
            {
                main_section: "Vehicles & Parts",
                sub_sections: [ { title: "Models", terms: { "aca": "Acadia", "ax": "Trax", "bui": "Buick", "cad": "Cadillac", "cace": "Cadillac Celestiq", "cac4": "Cadillac CT4", "caee": "Cadillac Escalade ESV", "caei": "Cadillac Escalade IQL", "caly": "Cadillac Lyriq", "can": "Canyon", "cax4": "Cadillac XT4", "cax5": "Cadillac XT5", "cax6": "Cadillac XT6", "chev": "Chevrolet", "enc": "Buick Enclave", "equ": "Equinox", "esc": "Escalade", "mal": "Chevrolet Malibu", "sie": "Sierra", "silv": "Silverado", "subu": "Suburban", "ter": "Terrain", "tra": "Traverse", "yuk": "Yukon" } }, { title: "Major Components & Systems", terms: { "ac": "Air Conditioning", "dic": "Driver Information Cluster (speedometer,etc)", "elec": "Electrical System Failures", "eng": "Engine", "hvac": "Heating & Cooling", "ign": "Ignition System", "ivi": "In-Vehicle Infotainment Display (front display above console)", "rbc": "Rear Back-Up Camera/Display", "sftw": "Software", "tran": "Transmission" } }, { title: "Engine & Drivetrain Parts", terms: { "alt": "Alternator", "ams": "Camshaft Position Sensor", "bo": "Burning Oil.", "brg": "Engine Bearings (Main/Rod)", "blk": "Cylinder Block", "cam": "Camshaft", "cat": "Catalytic Converter", "coi": "Ignition Coils", "con": "Connecting Rods", "cps": "Crankshaft Position Sensor", "crk": "Crankshaft", "cyl": "Cylinder Head(s)", "def": "Diesel Def", "die": "Diesel", "dur": "Duramax", "engf": "Engine Failure Repairs", "fpm": "Fuel Pump", "fpr": "Fuel Pressure Regulator", "hdg": "Head Gaskets", "acv": "Idle Air Control (Valve)", "icm": "Ignition Control Module", "inj": "Fuel Injectors", "lft": "Lifters", "maf": "Mass Airflow Sensor", "o2s": "Oxygen (O2) Sensors", "oil": "Engine Oil and Oil Filter", "pis": "Pistons and Piston Rings", "prd": "Pushrods", "pv": "Purge Valve", "spk": "Spark Plugs", "thb": "Throttle Body", "tmb": "Timing Chain/Belt and Components", "tmc": "Timing Chain/Components", "vb": "Valve Body", "vlv": "Valve Lifter Oil Manifold with Solenoid", "wpm": "Water Pump and Cooling System Components" } }, { title: "General Parts & Issues", terms: { "ab": "Air-Bag", "afs": "Air Filter", "cel": "Check Engine Light", "clus": "Instrument Cluster Malfunctions", "flt": "Fuel Filter", "fp": "Fuel Pump Failures", "goobi": "Google Built-In", "hea": "Heating/issue", "lif": "Lifter Issues", "oc": "Oil Consumption Issues", "pc": "Part/s of concern", "prof": "Display Profile", "pta": "Part is tank.", "pwst": "Power Steering Loss", "rad": "Vehicle Radio", "rka": "Rocker Arms", "rsd": "Rear Screen Display", "sta": "Stalling & Misfiring", "swc": "Ignition Switch", "veh": "vehicle" } } ]
            },
            {
                main_section: "Symptoms & Complaints",
                is_template_section: true,
                templates: [
                    { abbr: "engp", title: "Engine Problems", text: "Check Engine Light: A frequent issue that can signal anything from a loose gas cap to a sensor malfunction.\nOverheating: Can be caused by low coolant, leaks, or a faulty thermostat.\nMisfires or Sputtering: Often a result of bad spark plugs or damaged wires.\nKnocking/Pinging Sounds: This may be due to using the wrong fuel, low oil, or loose engine parts." },
                    { abbr: "brki", title: "Braking Issues", text: "Noisy Brakes: Squealing or grinding noises often indicate that the brake pads are worn.\nSpongy or Soft Pedal: This could mean there is air in the brake lines or a leak in the hydraulic system.\nVibrations/Pulsations: Often caused by warped rotors." },
                    { abbr: "trnp", title: "Transmission Problems", text: "Slipping: The engine revs without a corresponding increase in speed or the car loses power when shifting.\nHarsh or Delayed Shifting: Can be a result of low transmission fluid.\nFluid Leaks: May be a sign of worn seals or gaskets." },
                    { abbr: "elef", title: "Electrical System Failures", text: "Dead Battery: Frequently caused by leaving lights on or an old battery.\nFaulty Starter Motor: Prevents the engine from starting.\nDimming Lights or Whining Noise: This can indicate a failing alternator.\nMalfunctioning Sensors: Can cause inaccurate readings and performance problems.\nPower Window Problems: A common issue where windows do not operate correctly." },
                    { abbr: "othr", title: "Other Common Vehicle Issues", text: "Tire Concerns: This includes flat tires and uneven wear, which could signal alignment or inflation problems.\nSteering Problems: Issues such as difficulty turning or the car pulling to one side.\nCracked Windshield: This can be a safety hazard.\nHeadlights/Taillights: Failure of these lights reduces visibility.\nWindshield Wipers: Worn wipers can decrease visibility in bad weather." },
                    { abbr: "ari", title: "Auto Repair Issues", text: "Improper Repairs: The most common cause of dissatisfaction with a repair shop is the problem not being fixed correctly.\nHigh Prices: This is another frequent complaint, especially with dealerships.\nUnexpected Delays: Customers are often frustrated when repairs take longer than expected.\nReturn Visits: A repair that fails and requires another visit to the shop is a common issue.\nUnnecessary Services: Customers are concerned about being sold unnecessary parts or services.\nPoor Customer Service: Being treated poorly by staff is a frequent complaint.\nExceeding the Estimate: Unexpected costs are a major source of frustration.\nLack of Transparency: Customers feel ignored or misled due to inconsistent communication." },
                    { abbr: "dcp", title: "Deceptive Practices", text: "Bait-and-Switch Pricing: The advertised price is not the price that is honored.\nUnexpected Fees: Customers are charged for products or services that have little value.\nDeceptive Advertising: Misleading claims are made about the vehicle or its price." },
                    { abbr: "nvq", title: "New Vehicle Quality Issues", text: "Declining Quality: An increase in problems has been reported with basic items like door handles and cupholders.\nInfotainment and Software Issues: Problems with wireless charging and advanced driver assistance systems (ADAS) are common." },
                    { abbr: "ucs", title: "Used Car Sales Complaints", text: "Odometer Fraud: This involves selling a vehicle with a rolled-back odometer.\nLemon Vehicles: A customer might purchase a car that has pre-existing, unresolved issues.\n\"As Is\" Sales: Buyers may have no recourse when problems appear after the purchase." }
                ]
            },
            {
                main_section: "Concepts & Coverages",
                sub_sections: [ { title: "Formal", terms: { "btb": "Bumper To Bumper Coverage", "ca": "GM Cost Assistance", "cafa": "Catastrophic Failure", "ccl": "Extra Component Coverage Goodwill", "cct": "Onstar Connections", "con": "Concern/s/ed", "cpo": "Certified Pre-Owned Vehicle", "exw": "Extended Vehicle Warranty from an Independent Provider.", "fle": "Envolve/Fleet", "oop": "Out of Pocket Customer Pay", "pwt": "Powertrain Coverage", "rec": "recall", "rei": "Reimbursement", "sc": "Special Coverage", "vpr": "Vehicle Payment Reimbursement", "ti": "Trip Interruption" } }, { title: "General", terms: { "cafa": "Catastrophic Failure", "cct": "Onstar Connections", "com": "Compensation", "con": "Concern/s/ed", "iss": "issue", "lob": "Line of Business.", "ons": "Onstar" } } ]
            },
            {
                main_section: "Processes",
                sub_sections: [ { title: "Service & Repair", terms: { "app": "Appointment", "diag": "Diagnosis.", "dr": "Delayed Repair", "pd": "Part Delay", "rre": "Repeat Repairs/Appointments Failed Remedies" } }, { title: "Case Management", terms: { "ixf": "Inbound call from other department Transfer (caller was transferred from another department)", "cae": "The customer confirmed they reside in California. I advised customer a regional California advisor will follow up with them shortly.", "cxd": "Customer was transferred to the applicable department.", "int": "Internal: I was not able to find anything I could assist the customer with during this phone call.", "les": "The customer requested escalation to supervisor, manager, or next level authority. The customer was offered a Team Lead phone call within 2 business days. if the result was for a Live Manager Escalation warm transfer, then the customer refused a 2 day TL follow up.", "reg": "Advised customer of regional escalation with Senior Advisor will follow up within 48hrs. Sent to CAC Queue:", "tle": "Manager Escalation Follow-Up Phone Call within 2 business days.", "utc1": "Unable to Contact 1st Attempt-LVM? Sent UTC email to customer.", "utc2": "Unable to Contact 2nd Attempt-LVM? Sent UTC email to customer.", "utc3": "Unable to Contact 3rd and Final Attempt-LVM?" } }, { title: "Specific Programs", terms: { "bb": "Repurchase/Buyback", "ctp": "Courtesy Transportation Program", "mrp": "General Motors My Rewards Points Program", "prc": "Post-Repair Discussion About Potential Compensation/Reimbursement.", "reu": "Reunification Program", "rsa": "General Motors Roadside Warranty Assistance", "tre": "Tread Escalation" } } ]
            },
            {
                main_section: "Actions",
                sub_sections: [ { title: "Agent Actions", terms: { "ass": "Assisting", "fu": "Follow-Up", "goo": "Googled and found forums alleging known issues", "ic": "Confirmed", "mtc": "Move To Close Case", "pr": "Customer will call back post-repair", "rfi": "Request For Information", "sch": "Schedule" } }, { title: "Dealer/System Actions", terms: { "acc": "Accelerate", "acco": "Accomodate/tion", "cnd": "Could Not Duplicate", "dd": "The Dealer Diagnosed", "drf": "The Dealer Referred The Customer", "dln": "Dealer did not provide a loaner", "dly": "Dealer did provide a loaner", "fai": "Failed", "pro": "Dealer Programmed", "rep": "Repair/s", "rpl": "Replace/ment", "rpr": "Dealer Reprogrammed", "ser": "service", "ts": "Troubleshoot/ing" } } ]
            },
            {
                main_section: "Documents & Identifiers",
                sub_sections: [ { title: "Case & Vehicle", terms: { "add": "Customer Mailing Address.", "cn": "Case Number:", "cr": "The Customer Resides In", "ct": "Call Type (IBCC/OBCC):", "dn": "Dealer Name:", "mil": "Current Vehicle Mileage:", "o": "Outcome:", "r": "Reason:", "srr": "Service Request", "sym": "Symptoms:", "vin": "Vehicle V.I.N." } }, { title: "Documents & Records", terms: { "bul": "Bulletin", "calllog": "Case Information", "cd": "Call Details", "del": "Delivery Type", "doc": "Documentation/s", "em": "Email", "esi": "Insurance and liability claims (fire and/or medical)", "eta": "Estimated Time of Arrival/Repair", "fi": "Final Invoice", "gl": "GM Guidelines.", "om": "Owner's Manual", "pac": "PAC-Product Allegation (property damage,defect cause collision)", "pal": "Product Allegation", "pdf": "PDF Document", "tsb": "Technical Service Bulletin" } } ]
            },
            {
                main_section: "Places & Departments",
                sub_sections: [ { title: "GM & Dealer", terms: { "bac": "GM Dealer/BAC", "bu": "Business Unit.", "cac": "GM Customer Assistance Center", "ccd": "Cadillac Customer Care Team", "div": "GM Divisional Office", "dlr": "GM Dealer", "dpt": "Department", "gmf": "GM FInancial", "pdt": "Part Delay Team", "tac": "Technical Assistance Center (Dealer invite only)" } }, { title: "External & Other", terms: { "ind": "Independent Dealer/Supplier/Auto Mechanic", "bbb": "Better Business Bureau verbiage" } } ]
            },
            {
                main_section: "People & Roles",
                sub_sections: [ { title: "Dealer Roles", terms: { "ds": "Dealer Sales Manager", "dms": "Dealer Service Manager.", "dlrsa": "GM Sales at Dealer", "sd": "GM Dealer Service Director.", "tech": "Service Technician" } }, { title: "Corporate & Field", terms: { "cem": "Customer Experience Manager", "fse": "Field Service Engineer (Dealer Invite Only)", "rfl": "Regional Field Liason" } }, { title: "General", terms: { "cx": "Customer", "mfr": "manufacturer", "oa": "Owning Advisor" } } ]
            }
        ];

        const inputText = document.getElementById('inputText');
        const translatedText = document.getElementById('translatedText');
        const abbreviationsListDiv = document.getElementById('abbreviationsList');
        
        const lookupAbbreviations = masterList.reduce((acc, mainSection) => {
            if (mainSection.is_template_section) {
                (mainSection.templates || []).forEach(template => {
                    if (template.abbr) {
                        acc[template.abbr.toLowerCase()] = template.text;
                    }
                });
            } else {
                (mainSection.sub_sections || []).forEach(subSection => {
                    if (subSection.is_checklist_section){
                        (subSection.checklists || []).forEach(checklist => {
                            acc[checklist.abbr.toLowerCase()] = checklist.text;
                        });
                    } else {
                        const terms = subSection.terms || {};
                        for (const term in terms) {
                            acc[term.toLowerCase()] = terms[term];
                        }
                    }
                });
            }
            return acc;
        }, {});

        function performTranslation() {
            const currentText = inputText.value;
            const parts = currentText.split(/([ \n\t.,;!?()]+)/);
            const translatedParts = parts.map(part => {
                if (!part.trim()) return part;
                const lowerPart = part.toLowerCase();
                return lookupAbbreviations.hasOwnProperty(lowerPart) ? lookupAbbreviations[lowerPart] : part;
            });
            translatedText.value = translatedParts.join('');
        }

        function populateAbbreviationsList(query = '') {
            const listContainer = document.getElementById('abbreviationsList');
            listContainer.innerHTML = '';
            const safeQuery = query.trim().toLowerCase();
            const regex = safeQuery ? new RegExp(`(${query.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&')})`, 'gi') : null;

            masterList.forEach(mainSection => {
                const fullSectionText = JSON.stringify(mainSection).toLowerCase();
                if (safeQuery && !fullSectionText.includes(safeQuery)) {
                    return;
                }

                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'section';
                
                const title = document.createElement('h2');
                title.className = 'section-title';
                title.textContent = mainSection.main_section;
                
                const contentDiv = document.createElement('div');
                contentDiv.className = 'section-content';

                if (mainSection.is_template_section) {
                    const templateList = document.createElement('ul');
                    templateList.className = 'template-list';
                    mainSection.templates.forEach(template => {
                        const listItem = document.createElement('li');
                        let titleHtml = template.abbr ? `<strong>${template.abbr}</strong>: <span class="template-title">${template.title}</span>` : `<h4 class="template-title">${template.title}</h4>`;
                        let textHtml = template.text;
                        if(regex){
                            titleHtml = titleHtml.replace(regex, '<mark>$1</mark>');
                            textHtml = textHtml.replace(regex, '<mark>$1</mark>');
                        }
                        listItem.innerHTML = `${titleHtml} <button class="toggle-def-btn">[Show]</button><div class="collapsible-def">${textHtml}</div>`;
                        templateList.appendChild(listItem);
                    });
                    contentDiv.appendChild(templateList);
                } else {
                    (mainSection.sub_sections || []).forEach(subSection => {
                        const subTitle = document.createElement('h3');
                        subTitle.className = 'subsection-title';
                        subTitle.textContent = subSection.title;
                        contentDiv.appendChild(subTitle);
                        
                        const list = document.createElement('ul');
                        
                        if (subSection.is_checklist_section) {
                            list.className = 'term-list-single-col';
                            (subSection.checklists || []).forEach(checklist => {
                                const listItem = document.createElement('li');
                                let textHtml = checklist.text;
                                let titleHtml = checklist.title;
                                let abbrHtml = checklist.abbr;
                                if(regex){
                                    textHtml = textHtml.replace(regex, '<mark>$1</mark>');
                                    titleHtml = titleHtml.replace(regex, '<mark>$1</mark>');
                                    abbrHtml = abbrHtml.replace(regex, '<mark>$1</mark>');
                                }
                                listItem.innerHTML = `<strong>${abbrHtml}</strong>: ${titleHtml} <button class="toggle-def-btn">[Show]</button><div class="collapsible-def">${textHtml}</div>`;
                                list.appendChild(listItem);
                            });
                        } else {
                            list.className = 'term-list';
                            const sortedTerms = Object.keys(subSection.terms || {}).sort();
                            sortedTerms.forEach(term => {
                                const listItem = document.createElement('li');
                                let definitionHtml = subSection.terms[term];
                                let termHtml = term;
                                if(regex){
                                    definitionHtml = definitionHtml.replace(regex, '<mark>$1</mark>');
                                    termHtml = termHtml.replace(regex, '<mark>$1</mark>');
                                }
                                listItem.innerHTML = `<strong>${termHtml}</strong>: ${definitionHtml}`;
                                list.appendChild(listItem);
                            });
                        }
                        contentDiv.appendChild(list);
                    });
                }
                
                sectionDiv.appendChild(title);
                sectionDiv.appendChild(contentDiv);
                listContainer.appendChild(sectionDiv);
            });
        }
        
        function setupEventListeners() {
            const container = document.getElementById('abbreviationsContainer');
            const toggleBtn = document.getElementById('toggleAllBtn');

            container.addEventListener('click', function(event) {
                if (event.target.classList.contains('section-title')) {
                    const title = event.target;
                    const content = title.nextElementSibling;
                    title.classList.toggle('active');
                    content.classList.toggle('active');
                } else if (event.target.classList.contains('toggle-def-btn')) {
                     const btn = event.target;
                    const definitionDiv = btn.nextElementSibling;
                    const isVisible = definitionDiv.classList.toggle('visible');
                    btn.textContent = isVisible ? '[Hide]' : '[Show]';
                }
            });

            if (toggleBtn) {
                toggleBtn.addEventListener('click', function() {
                    const allTitles = container.querySelectorAll('.section-title');
                    const shouldOpen = allTitles.length > 0 && !allTitles[0].classList.contains('active');
                    allTitles.forEach(title => {
                        const content = title.nextElementSibling;
                        title.classList.toggle('active', shouldOpen);
                        content.classList.toggle('active', shouldOpen);
                    });
                });
            }
        }
        
        function setupCopyToScratchpad() {
            const copyBtn = document.getElementById('copyToScratchpadBtn');
            const scratchPad = document.getElementById('scratchPad');
            if (copyBtn && scratchPad) {
                copyBtn.addEventListener('click', function() {
                    const selectedText = window.getSelection().toString().trim();
                    if (selectedText) {
                        if (scratchPad.value.length > 0) {
                            scratchPad.value += '\n\n' + selectedText;
                        } else {
                            scratchPad.value = selectedText;
                        }
                        scratchPad.scrollTop = scratchPad.scrollHeight;
                    }
                });
            }
        }

        function setupAbbreviationSearch() {
            const searchInput = document.getElementById('abbreviationSearch');
            searchInput.addEventListener('input', (e) => {
                populateAbbreviationsList(e.target.value);
            });
        }
        
        // Initial page load
        const inputText = document.getElementById('inputText');
        inputText.addEventListener('input', performTranslation);
        
        populateAbbreviationsList();
        setupEventListeners();
        setupCopyToScratchpad();
        setupAbbreviationSearch();
        performTranslation();
    });
    </script>
</body>
</html>
