<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Call Logger & Abbreviation Translator</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f4f4f4; color: #333; }
        .main-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .container { display: flex; gap: 20px; width: 100%; margin-bottom: 20px; }
        .box { flex: 1; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column; }
        
        textarea, .textarea-lookalike {
            width: 100%;
            box-sizing: border-box;
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            resize: vertical;
            height: 150px;
            font-family: sans-serif;
            line-height: 1.5;
        }
        .textarea-lookalike {
            background-color: #e9ecef;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        h1, h2 { color: #0056b3; margin-top: 0; }
        .box h2 {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-bottom: 10px;
        }

        .action-btn {
            padding: 6px 12px;
            font-size: 14px;
            cursor: pointer;
            border: 1px solid #0056b3;
            background-color: #007bff;
            color: white;
            border-radius: 5px;
            margin-left: 10px;
            line-height: 1.2;
            text-align: center;
            flex-shrink: 0;
        }
        .action-btn:hover {
            background-color: #0056b3;
        }
        .btn-subtext {
            font-size: 10px;
            font-weight: normal;
            opacity: 0.8;
            display: block;
        }

        #abbreviationsContainer, #managerContainer { margin-top: 20px; padding-top: 20px; border-top: 1px solid #ddd; }
        .abbreviations-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        #managerContainer {
            display: none; /* Hidden by default */
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .manager-form {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        .manager-form label {
            font-weight: bold;
        }
        .manager-form input, .manager-form select {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
            font-size: 14px;
        }
        .manager-form input[type="text"] { flex-grow: 1; }
        .manager-controls { margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px; }

        .section {
            background-color: #fff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .section-title {
            font-weight: bold;
            color: #0056b3;
            font-size: 1.2em;
            margin: 0;
            cursor: pointer;
            position: relative;
            padding-right: 20px;
        }

        .section-title::after {
            content: 'â–¶';
            position: absolute;
            right: 5px;
            font-size: 0.8em;
            transition: transform 0.2s;
        }

        .section-title.active::after { transform: rotate(90deg); }
        .section-content { display: none; padding-top: 15px; }
        .section-content.active { display: block; }
        
        .subsection-title {
            font-weight: bold;
            color: #333;
            font-size: 1.1em;
            margin-top: 10px;
            margin-bottom: 5px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        
        .term-list {
            list-style-type: none;
            padding-left: 0;
            margin: 10px 0 0 0;
            font-size: 14px;
            column-count: 3;
            column-gap: 20px;
        }
        
        .template-list, .term-list-single-col {
             list-style-type: none;
             padding-left: 0;
             margin: 0;
             column-count: 1;
        }
        
        .template-list li, .term-list-single-col li { margin-bottom: 10px; }
        .term-list li { margin-bottom: 4px; -webkit-column-break-inside: avoid; page-break-inside: avoid; break-inside: avoid; }
        
        mark { background-color: yellow; color: black; }

        @media (max-width: 900px) { .term-list { column-count: 2; } }
        @media (max-width: 600px) { .container { flex-direction: column; } .term-list { column-count: 1; } }
    </style>
</head>
<body>
    <div class="main-header">
        <h1>Call Logger & Abbreviation Translator</h1>
    </div>
    <div class="container">
        <div class="box">
            <h2>Enter Text Here:</h2>
            <textarea id="inputText" placeholder="Start typing... for example: cx st..."></textarea>
        </div>
        <div class="box">
            <h2>Translated Text</h2>
            <div id="translatedText" class="textarea-lookalike"></div>
        </div>
        <div class="box">
            <h2>
                Scratch Pad
                <button id="rewordBtn" class="action-btn">Re-word</button>
            </h2>
            <textarea id="scratchPad" placeholder="Your notes here..."></textarea>
        </div>
    </div>
    <div id="abbreviationsContainer">
        <div class="abbreviations-header">
            <h2>Available Abbreviations</h2>
            <button id="manageBtn" class="action-btn">Manage</button>
            <button id="copyHighlightedBtn" class="action-btn">
                Copy To Scratch Pad
                <span class="btn-subtext">(what you highlight)</span>
            </button>
            <button id="toggleAllBtn" class="action-btn">Toggle All</button>
        </div>
        <div id="abbreviationsList"></div>
    </div>

    <div id="managerContainer">
        <h2>Abbreviation Manager</h2>
        <div class="manager-form">
            <label for="categorySelect">Category:</label>
            <select id="categorySelect"></select>
            <label for="abbrInput">Abbreviation:</label>
            <input type="text" id="abbrInput" placeholder="e.g., cx">
            <label for="textInput">Text:</label>
            <input type="text" id="textInput" placeholder="e.g., customer">
        </div>
        <div class="manager-controls">
            <button id="addUpdateBtn" class="action-btn">Add / Update</button>
            <button id="deleteBtn" class="action-btn" style="background-color: #dc3545; border-color: #c82333;">Delete</button>
            <button id="downloadBtn" class="action-btn" style="background-color: #28a745; border-color: #218838;">Download Updated Tool</button>
            <button id="closeManagerBtn" class="action-btn" style="background-color: #6c757d; border-color: #6c757d;">Close</button>
        </div>
    </div>

    <script>
    // --- MASTER DATA LIST (JSON-like Object) ---
    // IMPORTANT: This object is written into the downloaded file.
    const masterList = [
        {"main_section":"Two-Letter Terms","terms":{"ca":"cost assistance","cb":"called because","cd":"call details","cn":"case number","cr":"customer resides in","cs":"called about","cu":"customer is upset","cx":"customer","dd":"dealer diagnosed","dl":"dealer","dr":"dealer referred","fu":"follow-up","ia":"I advised","ic":"I confirmed","ie":"I educated","ii":"I informed","ir":"Improper repairs","is":"issue","mi":"mileage","nf":"nothing further","oa":"owning advisor","op":"out of pocket","pd":"part delay","pr":"post-repair","pt":"part","rb":"referred by","rp":"repair","rq":"requests","rr":"repeat repairs","sc":"special coverage","sm":"service manager","sr":"service request","st":"states","sv":"service","tc":"the customer","td":"the dealer","ts":"troubleshooting","ud":"unexpected delay","vh":"vehicle","vn":"VIN","wa":"wants"}},
        {"main_section":"Commonly Used Phrases","terms":{"aer":"Awaiting executive review/leverage.(RFL,GM1,BB)","bbt":"Bumper-to-Bumper coverage.","ccp":"Case closed.Customer was provided information, referred to a GM Dealer, will call back for further assistance.","cdcd":"The customer called because they are upset that the dealer has denied coverage or assistance with costs.","cem":"Customer Experience Manager.","cnd":"GM Dealer could not duplicate the concern.","coaf":"The customer called because they are upset that their owning advisor is not following up per expectations.","cwu":"Customer wants an update on","dan":"GM Dealer diagnosed as needing","dec":"De-escalated the customer.","dln":"Dealer did not provide a loaner.","dly":"Dealer did provide a loaner.","ibc":"Inbound Customer Call:","ivc":"I advised this is a common vehicle characteristic. And GM Dealer confirmed Normal behavior.","lcr":"Left message, awaiting callback.","ldv":"Left a detailed voicemail.","obc":"Outbound Customer Call:","pcn":"Provided the customer with their case number.","pdl":"part delay","pwt":"Powertrain coverage.","rfi":"The customer requested information regarding","tsb":"Customer was educated on Technical Service Bulletins-no recall or covered repair.","ves":"exhibiting symptoms of"}},
        {"main_section":"Agent Starters & Finishers","terms":{"ia":"I advised the customer ","icb":"I called because ","fua":"I let customer know I will work their request and follow up with them accordingly.","fud":"I let customer know i will follow up with the customer after contacting the dealer.","scd":"I let customer know I will send their complaint to the dealer; customer is aware no follow-up is expected."}},
    ]; // This is a simplified version for display. The full version will be in the script.

    document.addEventListener('DOMContentLoaded', function() {
        const fullMasterList = [
            {"main_section":"Two-Letter Terms","terms":{"ca":"cost assistance","cb":"called because","cd":"call details","cn":"case number","cr":"customer resides in","cs":"called about","cu":"customer is upset","cx":"customer","dd":"dealer diagnosed","dl":"dealer","dr":"dealer referred","fu":"follow-up","ia":"I advised","ic":"I confirmed","ie":"I educated","ii":"I informed","ir":"Improper repairs","is":"issue","mi":"mileage","nf":"nothing further","oa":"owning advisor","op":"out of pocket","pd":"part delay","pr":"post-repair","pt":"part","rb":"referred by","rp":"repair","rq":"requests","rr":"repeat repairs","sc":"special coverage","sm":"service manager","sr":"service request","st":"states","sv":"service","tc":"the customer","td":"the dealer","ts":"troubleshooting","ud":"unexpected delay","vh":"vehicle","vn":"VIN","wa":"wants"}},
            {"main_section":"Commonly Used Phrases","terms":{"aer":"Awaiting executive review/leverage.(RFL,GM1,BB)","bbt":"Bumper-to-Bumper coverage.","ccp":"Case closed.Customer was provided information, referred to a GM Dealer, will call back for further assistance.","cdcd":"The customer called because they are upset that the dealer has denied coverage or assistance with costs.","cem":"Customer Experience Manager.","cnd":"GM Dealer could not duplicate the concern.","coaf":"The customer called because they are upset that their owning advisor is not following up per expectations.","cwu":"Customer wants an update on","dan":"GM Dealer diagnosed as needing","dec":"De-escalated the customer.","dln":"Dealer did not provide a loaner.","dly":"Dealer did provide a loaner.","ibc":"Inbound Customer Call:","ivc":"I advised this is a common vehicle characteristic. And GM Dealer confirmed Normal behavior.","lcr":"Left message, awaiting callback.","ldv":"Left a detailed voicemail.","obc":"Outbound Customer Call:","pcn":"Provided the customer with their case number.","pdl":"part delay","pwt":"Powertrain coverage.","rfi":"The customer requested information regarding","tsb":"Customer was educated on Technical Service Bulletins-no recall or covered repair.","ves":"exhibiting symptoms of"}},
            {"main_section":"Agent Starters & Finishers","terms":{"ia":"I advised the customer ","icb":"I called because ","fua":"I let customer know I will work their request and follow up with them accordingly.","fud":"I let customer know i will follow up with the customer after contacting the dealer.","scd":"I let customer know I will send their complaint to the dealer; customer is aware no follow-up is expected."}},
        ];

        let currentMasterList = JSON.parse(JSON.stringify(fullMasterList)); // Create a deep copy to work with

        const inputText = document.getElementById('inputText');
        const translatedText = document.getElementById('translatedText');
        const scratchPad = document.getElementById('scratchPad');
        const abbreviationsListDiv = document.getElementById('abbreviationsList');
        
        let lookupMap = new Map();

        function buildLookupMap() {
            lookupMap.clear();
            currentMasterList.forEach(section => {
                if (section.terms) {
                    for (const abbr in section.terms) {
                        lookupMap.set(abbr.toLowerCase(), section.terms[abbr]);
                    }
                }
            });
        }
        
        function performTranslation() {
            const currentText = inputText.value;
            const parts = currentText.split(/(\s+)/);
            const translatedParts = parts.map(part => {
                if (!part || part.trim() === '') return part;
                const lowerPart = part.toLowerCase();
                return lookupMap.get(lowerPart) || part;
            });
            translatedText.innerHTML = translatedParts.join('').replace(/\n/g, '<br>');
        }

        function populateAbbreviationsList() {
            abbreviationsListDiv.innerHTML = '';
            currentMasterList.forEach(mainSection => {
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'section';
                const title = document.createElement('h2');
                title.className = 'section-title';
                title.textContent = mainSection.main_section;
                const contentDiv = document.createElement('div');
                contentDiv.className = 'section-content';

                const list = document.createElement('ul');
                list.className = 'term-list';
                const sortedTerms = Object.keys(mainSection.terms || {}).sort();
                sortedTerms.forEach(term => {
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `<strong>${term}</strong>: ${mainSection.terms[term]}`;
                    list.appendChild(listItem);
                });
                contentDiv.appendChild(list);
                
                title.addEventListener('click', () => {
                    title.classList.toggle('active');
                    contentDiv.classList.toggle('active');
                });
                sectionDiv.appendChild(title);
                sectionDiv.appendChild(contentDiv);
                abbreviationsListDiv.appendChild(sectionDiv);
            });
        }
        
        // --- MANAGER FUNCTIONS ---
        const managerContainer = document.getElementById('managerContainer');
        const manageBtn = document.getElementById('manageBtn');
        const closeManagerBtn = document.getElementById('closeManagerBtn');
        const categorySelect = document.getElementById('categorySelect');
        const abbrInput = document.getElementById('abbrInput');
        const textInput = document.getElementById('textInput');
        const addUpdateBtn = document.getElementById('addUpdateBtn');
        const deleteBtn = document.getElementById('deleteBtn');
        const downloadBtn = document.getElementById('downloadBtn');

        function setupManager() {
            manageBtn.addEventListener('click', () => {
                const passcode = prompt("Enter passcode to manage abbreviations:");
                if (passcode === "7277") {
                    managerContainer.style.display = 'block';
                    populateCategorySelect();
                } else if (passcode !== null) {
                    alert("Incorrect passcode.");
                }
            });

            closeManagerBtn.addEventListener('click', () => {
                managerContainer.style.display = 'none';
            });

            addUpdateBtn.addEventListener('click', () => {
                const category = categorySelect.value;
                const abbr = abbrInput.value.trim().toLowerCase();
                const text = textInput.value.trim();
                if (!category || !abbr || !text) {
                    alert("All fields are required.");
                    return;
                }
                
                const section = currentMasterList.find(s => s.main_section === category);
                if (section) {
                    section.terms[abbr] = text;
                    alert(`'${abbr}' has been added/updated in '${category}'.`);
                    abbrInput.value = '';
                    textInput.value = '';
                    // Refresh everything
                    buildLookupMap();
                    populateAbbreviationsList();
                }
            });

            deleteBtn.addEventListener('click', () => {
                const category = categorySelect.value;
                const abbr = abbrInput.value.trim().toLowerCase();
                if (!category || !abbr) {
                    alert("Category and Abbreviation are required to delete.");
                    return;
                }
                 const section = currentMasterList.find(s => s.main_section === category);
                 if (section && section.terms[abbr]) {
                    if (confirm(`Are you sure you want to delete '${abbr}'?`)) {
                        delete section.terms[abbr];
                        alert(`'${abbr}' has been deleted.`);
                        abbrInput.value = '';
                        textInput.value = '';
                        // Refresh everything
                        buildLookupMap();
                        populateAbbreviationsList();
                    }
                 } else {
                    alert(`Abbreviation '${abbr}' not found in category '${category}'.`);
                 }
            });

            downloadBtn.addEventListener('click', () => {
                const fullHtml = document.documentElement.outerHTML;
                const newMasterListString = "const masterList = " + JSON.stringify(currentMasterList, null, 4) + ";";
                
                // This regex finds the masterList variable declaration and replaces it.
                const updatedHtml = fullHtml.replace(/const masterList = \[[\s\S]*?\];/, newMasterListString);

                const blob = new Blob([updatedHtml], { type: 'text/html' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = 'updated_call_logger.html';
                a.click();
            });
        }

        function populateCategorySelect() {
            categorySelect.innerHTML = '';
            currentMasterList.forEach(section => {
                // Only allow editing of the simple term lists
                if(section.terms){
                    const option = document.createElement('option');
                    option.value = section.main_section;
                    option.textContent = section.main_section;
                    categorySelect.appendChild(option);
                }
            });
        }

        // --- INITIALIZE ALL FUNCTIONS ---
        buildLookupMap(); // Initial build
        inputText.addEventListener('input', performTranslation);
        populateAbbreviationsList();
        setupManager();
        
        // Other button initializations can go here
        setupToggleAllButton();
        setupCopyHighlightedButton();
        setupRewordButton(); 
        performTranslation();
    });
    </script>
</body>
</html>
